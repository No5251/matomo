(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["ScheduledReports"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["ScheduledReports"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,r){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="plugins/ScheduledReports/vue/dist/",r(r.s="fae3")}({"19dc":function(t,r){t.exports=e},"8bbf":function(e,r){e.exports=t},a5a2:function(e,t){e.exports=r},fae3:function(e,t,r){"use strict";if(r.r(t),r.d(t,"ReportParameters",(function(){return d})),r.d(t,"ManageScheduledReport",(function(){return it})),"undefined"!==typeof window){var o=window.document.currentScript,n=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(r.p=n[1])}var l=r("8bbf");
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */const i={key:0};function c(e,t,r,o,n,c){const a=Object(l["resolveComponent"])("Field");return e.report?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",i,[Object(l["createElementVNode"])("div",null,[Object(l["withDirectives"])(Object(l["createVNode"])(a,{uicontrol:"checkbox",name:"report_email_me",introduction:e.translate("ScheduledReports_SendReportTo"),"model-value":e.report.emailMe,"onUpdate:modelValue":t[0]||(t[0]=t=>e.$emit("change","emailMe",t)),title:`${e.translate("ScheduledReports_SentToMe")} (${e.currentUserEmail})`},null,8,["introduction","model-value","title"]),[[l["vShow"],"email"===e.report.type]])]),Object(l["createElementVNode"])("div",null,[Object(l["withDirectives"])(Object(l["createVNode"])(a,{uicontrol:"textarea","var-type":"array","model-value":e.report.additionalEmails,"onUpdate:modelValue":t[1]||(t[1]=t=>e.$emit("change","additionalEmails",t)),title:e.translate("ScheduledReports_AlsoSendReportToTheseEmails")},null,8,["model-value","title"]),[[l["vShow"],"email"===e.report.type]])])])):Object(l["createCommentVNode"])("",!0)}var a=r("a5a2"),s=Object(l["defineComponent"])({props:{report:{type:Object,required:!0},reportType:{type:String,required:!0},defaultDisplayFormat:{type:Number,required:!0},defaultEmailMe:{type:Boolean,required:!0},defaultEvolutionGraph:{type:Boolean,required:!0},currentUserEmail:{type:String,required:!0}},emits:["change"],components:{Field:a["Field"]},setup(e){const{resetReportParametersFunctions:t,updateReportParametersFunctions:r,getReportParametersFunctions:o}=window;t[e.reportType]||(t[e.reportType]=t=>{t.displayFormat=e.defaultDisplayFormat,t.emailMe=e.defaultEmailMe,t.evolutionGraph=e.defaultEvolutionGraph,t.additionalEmails=[]}),r[e.reportType]||(r[e.reportType]=e=>{null!==e&&void 0!==e&&e.parameters&&["displayFormat","emailMe","evolutionGraph","additionalEmails"].forEach(t=>{t in e.parameters&&(e[t]=e.parameters[t])})}),o[e.reportType]||(o[e.reportType]=e=>({displayFormat:e.displayFormat,emailMe:e.emailMe,evolutionGraph:e.evolutionGraph,additionalEmails:e.additionalEmails||[],enforceOrder:!0}))}});s.render=c;var d=s;const p={class:"emailReports",ref:"root"},u={ref:"reportSentSuccess"},m={ref:"reportUpdatedSuccess"},b=Object(l["createElementVNode"])("div",{id:"ajaxError",style:{display:"none"}},null,-1),O={id:"ajaxLoadingDiv",style:{display:"none"}},h={class:"loadingPiwik"},y={class:"loadingSegment"},j=Object(l["createElementVNode"])("a",{id:"bottom"},null,-1);function g(e,t,r,o,n,i){const c=Object(l["resolveComponent"])("MatomoLoader"),a=Object(l["resolveComponent"])("ListReports"),s=Object(l["resolveComponent"])("AddReport");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",p,[Object(l["createElementVNode"])("div",u,null,512),Object(l["createElementVNode"])("div",m,null,512),Object(l["createElementVNode"])("div",null,[b,Object(l["createElementVNode"])("div",O,[Object(l["createElementVNode"])("div",h,[Object(l["createVNode"])(c),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("General_LoadingData")),1)]),Object(l["createElementVNode"])("div",y,Object(l["toDisplayString"])(e.translate("SegmentEditor_LoadingSegmentedDataMayTakeSomeTime")),1)]),Object(l["withDirectives"])(Object(l["createVNode"])(a,{"content-title":e.contentTitle,"user-login":e.userLogin,"login-module":e.loginModule,reports:e.reports,"site-name":e.decodedSiteName,"segment-editor-activated":e.segmentEditorActivated,"saved-segments-by-id":e.savedSegmentsById,periods:e.periods,"report-types":e.reportTypes,"download-output-type":e.downloadOutputType,language:e.language,"report-formats-by-report-type":e.reportFormatsByReportType,"sending-reports":e.sendingReports,onCreate:t[0]||(t[0]=t=>e.createReport()),onEdit:t[1]||(t[1]=t=>e.editReport(t)),onDelete:t[2]||(t[2]=t=>e.deleteReport(t)),onSendnow:t[3]||(t[3]=t=>e.sendReportNow(t))},null,8,["content-title","user-login","login-module","reports","site-name","segment-editor-activated","saved-segments-by-id","periods","report-types","download-output-type","language","report-formats-by-report-type","sending-reports"]),[[l["vShow"],e.showReportsList]]),e.showReportForm?(Object(l["openBlock"])(),Object(l["createBlock"])(s,{key:0,report:e.report,periods:e.periods,"param-periods":e.paramPeriods,"report-type-options":e.reportTypeOptions,"report-formats-by-report-type-options":e.reportFormatsByReportTypeOptions,"display-formats":e.displayFormats,"reports-by-category-by-report-type":e.reportsByCategoryByReportType,"allow-multiple-reports-by-report-type":e.allowMultipleReportsByReportType,"count-websites":e.countWebsites,"site-name":e.decodedSiteName,"selected-reports":e.selectedReports,"selected-reports-order":e.selectedReportsOrder,"report-types":e.reportTypes,"segment-editor-activated":e.segmentEditorActivated,"saved-segments-by-id":e.savedSegmentsById,onToggleSelectedReport:t[4]||(t[4]=t=>e.toggleSelectedReport(t.reportType,t.uniqueId)),onReorderSelectedReports:t[5]||(t[5]=t=>e.onReorderSelectedReports(t.reportType,t.order)),onChange:t[6]||(t[6]=t=>e.onChangeProperty(t.prop,t.value)),onSubmit:t[7]||(t[7]=t=>e.submitReport())},{"report-parameters":Object(l["withCtx"])(()=>[Object(l["renderSlot"])(e.$slots,"report-parameters")]),_:3},8,["report","periods","param-periods","report-type-options","report-formats-by-report-type-options","display-formats","reports-by-category-by-report-type","allow-multiple-reports-by-report-type","count-websites","site-name","selected-reports","selected-reports-order","report-types","segment-editor-activated","saved-segments-by-id"])):Object(l["createCommentVNode"])("",!0),j])],512)}var v=r("19dc");const R=Object(l["createElementVNode"])("div",{class:"clear"},null,-1),f={key:0},S=["innerHTML"],E={id:"emailScheduleInlineHelp",class:"inline-help-node"},N=Object(l["createElementVNode"])("br",null,null,-1),k={id:"emailReportPeriodInlineHelp",class:"inline-help-node"},V=Object(l["createElementVNode"])("br",null,null,-1),B=Object(l["createElementVNode"])("br",null,null,-1),w={key:0,id:"reportHourHelpText",class:"inline-help-node"},_=["textContent"],T={ref:"reportParameters"},C={class:"report_evolution_graph"},P={class:"row evolution-graph-period"},F={class:"col s12"},D={for:"report_evolution_period_for_each"},q=["checked"],x=["innerHTML"],M={class:"col s12"},L={for:"report_evolution_period_for_prev"},I=["checked"],H=["value"],A={class:"row"},U={class:"col s12"},G={class:"reportCategory"},z={class:"listReports"},W=["name","type","id","checked","onChange"],Z={key:0,class:"entityInlineHelp"},K=Object(l["createElementVNode"])("br",null,null,-1),X=["innerHTML"];function J(e,t,r,o,n,i){const c=Object(l["resolveComponent"])("Field"),a=Object(l["resolveComponent"])("SelectedReportsList"),s=Object(l["resolveComponent"])("SaveButton"),d=Object(l["resolveComponent"])("ContentBlock"),p=Object(l["resolveDirective"])("form");return Object(l["openBlock"])(),Object(l["createBlock"])(d,{class:"entityAddContainer","content-title":e.contentTitle},{default:Object(l["withCtx"])(()=>[R,Object(l["withDirectives"])((Object(l["openBlock"])(),Object(l["createElementBlock"])("form",{id:"addEditReport",onSubmit:t[13]||(t[13]=t=>e.$emit("submit"))},[Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"text",name:"website",title:e.translate("General_Website"),disabled:!0,"model-value":e.siteName},null,8,["title","model-value"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"textarea",name:"report_description",title:e.translate("General_Description"),"model-value":e.report.description,"onUpdate:modelValue":t[0]||(t[0]=t=>e.$emit("change",{prop:"description",value:t})),"inline-help":e.translate("ScheduledReports_DescriptionOnFirstPageScheduledReport")},null,8,["title","model-value","inline-help"])]),e.segmentEditorActivated?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",f,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_segment",title:e.translate("SegmentEditor_ChooseASegment"),"model-value":e.report.idsegment,"onUpdate:modelValue":t[1]||(t[1]=t=>e.$emit("change",{prop:"idsegment",value:t})),options:e.savedSegmentsById},{"inline-help":Object(l["withCtx"])(()=>[e.segmentEditorActivated?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:0,id:"reportSegmentInlineHelp",class:"inline-help-node",innerHTML:e.$sanitize(e.reportSegmentInlineHelp)},null,8,S)):Object(l["createCommentVNode"])("",!0)]),_:1},8,["title","model-value","options"])])):Object(l["createCommentVNode"])("",!0),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_schedule","model-value":e.report.period,"onUpdate:modelValue":t[2]||(t[2]=t=>{e.$emit("change",{prop:"period",value:t}),e.$emit("change",{prop:"periodParam",value:"never"===e.report.period?null:e.report.period})}),title:e.translate("ScheduledReports_ReportSchedule"),options:e.periods},{"inline-help":Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",E,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("ScheduledReports_WeeklyScheduleHelp"))+" ",1),N,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_MonthlyScheduleHelp")),1)])]),_:1},8,["model-value","title","options"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_period","model-value":e.report.periodParam,"onUpdate:modelValue":t[3]||(t[3]=t=>e.$emit("change",{prop:"periodParam",value:t})),options:e.paramPeriods,title:e.translate("ScheduledReports_ReportPeriod")},{"inline-help":Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",k,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("ScheduledReports_ScheduleReportPeriodHelp"))+" ",1),V,B,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_ScheduleReportPeriodHelp2")),1)])]),_:1},8,["model-value","options","title"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_hour","model-value":e.report.hour,"onUpdate:modelValue":t[4]||(t[4]=t=>e.$emit("change",{prop:"hour",value:t})),title:e.translate("ScheduledReports_ReportHour","X"),options:e.reportHours},{"inline-help":Object(l["withCtx"])(()=>[0!==e.timezoneOffset&&"0"!==e.timezoneOffset?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",w,[Object(l["createElementVNode"])("span",{textContent:Object(l["toDisplayString"])(e.reportHourUtc)},null,8,_)])):Object(l["createCommentVNode"])("",!0)]),_:1},8,["model-value","title","options"])]),Object(l["createElementVNode"])("div",null,[Object(l["createVNode"])(c,{uicontrol:"select",name:"report_type",disabled:1===e.reportTypes.length,"model-value":e.report.type,"onUpdate:modelValue":t[5]||(t[5]=t=>e.$emit("change",{prop:"type",value:t})),title:e.translate("ScheduledReports_ReportType"),options:e.reportTypeOptions},null,8,["disabled","model-value","title","options"])]),Object(l["createElementVNode"])("div",T,[Object(l["renderSlot"])(e.$slots,"report-parameters")],512),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.reportFormatsByReportTypeOptions,(t,r)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:r},[Object(l["withDirectives"])(Object(l["createVNode"])(c,{uicontrol:"select",name:"report_format",title:e.translate("ScheduledReports_ReportFormat"),class:Object(l["normalizeClass"])(r),"model-value":e.report["format"+r],"onUpdate:modelValue":t=>e.$emit("change",{prop:"format"+r,value:t}),options:t},null,8,["title","class","model-value","onUpdate:modelValue","options"]),[[l["vShow"],e.report.type===r]])]))),128)),Object(l["withDirectives"])(Object(l["createElementVNode"])("div",null,[Object(l["createElementVNode"])("div",{class:Object(l["normalizeClass"])(e.report.type)},[Object(l["createVNode"])(c,{uicontrol:"select",name:"display_format","model-value":e.report.displayFormat,"onUpdate:modelValue":t[6]||(t[6]=t=>e.$emit("change",{prop:"displayFormat",value:t})),options:e.displayFormats,introduction:e.translate("ScheduledReports_AggregateReportsFormat")},null,8,["model-value","options","introduction"])],2),Object(l["createElementVNode"])("div",C,[Object(l["withDirectives"])(Object(l["createVNode"])(c,{uicontrol:"checkbox",name:"report_evolution_graph",title:e.translate("ScheduledReports_EvolutionGraph",5),"model-value":e.report.evolutionGraph,"onUpdate:modelValue":t[7]||(t[7]=t=>e.$emit("change",{prop:"evolutionGraph",value:t}))},null,8,["title","model-value"]),[[l["vShow"],-1!==[2,"2",3,"3"].indexOf(e.report.displayFormat)]])]),Object(l["withDirectives"])(Object(l["createElementVNode"])("div",P,[Object(l["createElementVNode"])("div",F,[Object(l["createElementVNode"])("label",D,[Object(l["createElementVNode"])("input",{id:"report_evolution_period_for_each",name:"report_evolution_period_for",type:"radio",value:"each",checked:"each"===e.report.evolutionPeriodFor,onChange:t[8]||(t[8]=t=>e.$emit("change",{prop:"evolutionPeriodFor",value:t.target.value}))},null,40,q),Object(l["createElementVNode"])("span",{innerHTML:e.$sanitize(e.evolutionGraphsShowForEachInPeriod)},null,8,x)])]),Object(l["createElementVNode"])("div",M,[Object(l["createElementVNode"])("label",L,[Object(l["createElementVNode"])("input",{id:"report_evolution_period_for_prev",name:"report_evolution_period_for",type:"radio",value:"prev",checked:"prev"===e.report.evolutionPeriodFor,onChange:t[9]||(t[9]=t=>e.$emit("change",{prop:"evolutionPeriodFor",value:t.target.value}))},null,40,I),Object(l["createElementVNode"])("span",null,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.translate("ScheduledReports_EvolutionGraphsShowForPreviousN",e.frequencyPeriodPlural))+": ",1),Object(l["createElementVNode"])("input",{type:"number",name:"report_evolution_period_n",value:e.report.evolutionPeriodN,onKeydown:t[10]||(t[10]=t=>e.onEvolutionPeriodN(t)),onChange:t[11]||(t[11]=t=>e.onEvolutionPeriodN(t))},null,40,H)])])])],512),[[l["vShow"],-1!==[1,"1",2,"2",3,"3"].indexOf(e.report.displayFormat)]])],512),[[l["vShow"],"pdf"===e.report["format"+e.report.type]||"html"===e.report["format"+e.report.type]]]),Object(l["createElementVNode"])("div",A,[Object(l["createElementVNode"])("h3",U,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportsIncluded")),1)]),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.reportsByCategoryByReportTypeInColumns,(t,r)=>Object(l["withDirectives"])((Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{name:"reportsList",class:Object(l["normalizeClass"])("row "+r),key:r},[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t,(t,o)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{class:"col s12 m6",key:o},[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t,(t,o)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:o},[Object(l["createElementVNode"])("h3",G,Object(l["toDisplayString"])(o),1),Object(l["createElementVNode"])("ul",z,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t,t=>{var o;return Object(l["openBlock"])(),Object(l["createElementBlock"])("li",{key:t.uniqueId},[Object(l["createElementVNode"])("label",null,[Object(l["createElementVNode"])("input",{name:r+"Reports",type:e.allowMultipleReportsByReportType[r]?"checkbox":"radio",id:`${r}${t.uniqueId}`,checked:null===(o=e.selectedReports[r])||void 0===o?void 0:o[t.uniqueId],onChange:o=>e.$emit("toggleSelectedReport",{reportType:r,uniqueId:t.uniqueId})},null,40,W),Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(e.decode(t.name)),1),"MultiSites_getAll"===t.uniqueId?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",Z,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportIncludeNWebsites",e.countWebsites)),1)):Object(l["createCommentVNode"])("",!0)])])}),128))]),K]))),128))]))),128))],2)),[[l["vShow"],e.report.type===r]])),128)),Object(l["createVNode"])(a,{reports:e.selectedReportsForCurrentType,enabled:e.allowMultipleReportsByReportType[e.report.type],onReorder:e.onSelectedReportsReorder},null,8,["reports","enabled","onReorder"]),Object(l["createVNode"])(s,{value:e.saveButtonTitle,onConfirm:t[12]||(t[12]=t=>e.$emit("submit"))},null,8,["value"]),Object(l["createElementVNode"])("div",{class:"entityCancel",innerHTML:e.$sanitize(e.entityCancelText)},null,8,X)],32)),[[p]])]),_:3},8,["content-title"])}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function Q(e,t){return""+(24+parseFloat(e)+t)%24}const Y={key:0,class:"selectedReportsWrapper"},ee={class:"selectedReportsHeading"},te={class:"selectedReportsHelp"},re={class:"selectedReportsList",ref:"list"},oe=["data-unique-id"],ne=Object(l["createElementVNode"])("span",{class:"icon-menu-hamburger drag-icon"},null,-1),le={class:"selectedReportName"};function ie(e,t,r,o,n,i){return e.shouldDisplay?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",Y,[Object(l["createElementVNode"])("div",ee,[Object(l["createElementVNode"])("h3",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_SelectedReports")),1)]),Object(l["createElementVNode"])("p",te,Object(l["toDisplayString"])(e.translate("ScheduledReports_SelectedReportsHelp")),1),Object(l["createElementVNode"])("ul",re,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.reports,t=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("li",{key:t.uniqueId,"data-unique-id":t.uniqueId},[ne,Object(l["createElementVNode"])("span",le,Object(l["toDisplayString"])(e.decode(t.name)),1)],8,oe))),128))],512)])):Object(l["createCommentVNode"])("",!0)}const{$:ce}=window;var ae=Object(l["defineComponent"])({name:"SelectedReportsList",props:{reports:{type:Array,required:!0},enabled:{type:Boolean,default:!0}},emits:["reorder"],computed:{shouldDisplay(){return!!this.enabled&&this.reports.length>0}},watch:{reports(){this.scheduleRefresh()},enabled(){this.scheduleRefresh()}},mounted(){this.scheduleRefresh()},beforeUnmount(){this.destroySortable()},methods:{translate:v["translate"],decode(e){return v["Matomo"].helper.htmlDecode(e)},getListElement(){return this.$refs.list},scheduleRefresh(){Object(l["nextTick"])(()=>{this.refreshSortable()})},refreshSortable(){if(!this.shouldDisplay)return void this.destroySortable();const e=this.getListElement();if(!e)return;const t=ce(e);t.data("ui-sortable")?t.sortable("refresh"):t.sortable({axis:"y",helper:"clone",placeholder:"selectedReportPlaceholder",stop:()=>{this.emitOrder()}})},destroySortable(){const e=this.getListElement();if(!e)return;const t=ce(e);t.data("ui-sortable")&&t.sortable("destroy")},emitOrder(){const e=this.getListElement();if(!e)return;const t=ce(e).find("li").map((function(){return String(ce(this).data("uniqueId"))})).get();this.$emit("reorder",t)}}});ae.render=ie;var se=ae,de=Object(l["defineComponent"])({props:{report:{type:Object,required:!0},selectedReports:Object,selectedReportsOrder:{type:Object,default:()=>({})},paramPeriods:{type:Object,required:!0},reportTypeOptions:{type:Object,required:!0},reportFormatsByReportTypeOptions:{type:Object,required:!0},displayFormats:{type:Object,required:!0},reportsByCategoryByReportType:{type:Object,required:!0},allowMultipleReportsByReportType:{type:Object,required:!0},countWebsites:{type:Number,required:!0},siteName:{type:String,required:!0},reportTypes:{type:Object,required:!0},segmentEditorActivated:Boolean,savedSegmentsById:Object,periods:{type:Object,required:!0}},emits:["submit","change","toggleSelectedReport","reorderSelectedReports"],components:{ContentBlock:v["ContentBlock"],Field:a["Field"],SaveButton:a["SaveButton"],SelectedReportsList:se},directives:{Form:a["Form"]},created(){this.onEvolutionPeriodN=Object(v["debounce"])(this.onEvolutionPeriodN,50)},methods:{onEvolutionPeriodN(e){this.$emit("change",{prop:"evolutionPeriodN",value:e.target.value})},decode(e){return v["Matomo"].helper.htmlDecode(e)},onSelectedReportsReorder(e){this.report&&this.report.type&&this.$emit("reorderSelectedReports",{reportType:this.report.type,order:e})}},setup(e,t){const r=Object(l["ref"])(null);return Object(l["watch"])(()=>e.report,e=>{const t=r.value;t.querySelectorAll("[vue-entry]").forEach(t=>{$(t).data("vueAppInstance").report_=e})}),Object(l["onMounted"])(()=>{const o=r.value;v["Matomo"].helper.compileVueEntryComponents(o,{report:e.report,onChange(e,r){t.emit("change",{prop:e,value:r})}})}),{reportParameters:r}},beforeUnmount(){const e=this.$refs.reportParameters;v["Matomo"].helper.destroyVueComponent(e)},computed:{enforceSelectedReportOrder(){var e;const t=(null===(e=this.report)||void 0===e?void 0:e.parameters)||{};return"undefined"!==typeof t.enforceOrder&&!!t.enforceOrder},selectedReportsOrderNormalized(){const e={},t=this.selectedReports||{};return Object.keys(t).forEach(r=>{const o=t[r]||{},n=((this.selectedReportsOrder||{})[r]||[]).filter(e=>o[e]),l=Object.keys(o).filter(e=>o[e]&&-1===n.indexOf(e));e[r]=n.concat(l)}),e},reportsLookup(){const e=this.reportsByCategoryByReportType,t={};return Object.entries(e).forEach(([e,r])=>{t[e]=t[e]||{},Object.values(r).forEach(r=>{r.forEach(r=>{t[e][r.uniqueId]=r})})}),t},selectedReportsForCurrentType(){var e;const t=null===(e=this.report)||void 0===e?void 0:e.type;if(!t)return[];const r=(this.selectedReports||{})[t]||{};let o=[];if(this.enforceSelectedReportOrder)o=this.selectedReportsOrderNormalized[t]||[];else{const e=this.reportsByCategoryByReportType[t]||{},n=[];Object.values(e).forEach(e=>{e.forEach(e=>{r[e.uniqueId]&&n.push(e.uniqueId)})}),o=n}if(o.length||(o=Object.keys(r).filter(e=>r[e])),!o.length)return[];const n=this.reportsLookup[t]||{};return o.map(e=>n[e]).filter(e=>!!e)},reportsByCategoryByReportTypeInColumns(){const e=this.reportsByCategoryByReportType,t=Object.entries(e).map(([e,t])=>{const r=Math.floor((Object.keys(t).length+1)/2),o={},n={};let l=o;return Object.entries(t).forEach(([e,t])=>{l[e]=t,Object.keys(l).length>=r&&(l=n)}),[e,[o,n]]});return Object.fromEntries(t)},entityCancelText(){return Object(v["translate"])("General_OrCancel",'<a class="entityCancelLink">',"</a>")},frequencyPeriodSingle(){if(!this.report||!this.report.period)return"";const{ReportPlugin:e}=window;let t=e.periodTranslations[this.report.period];return t||(t=e.periodTranslations.day),t.single},frequencyPeriodPlural(){if(!this.report||!this.report.period)return"";const{ReportPlugin:e}=window;let t=e.periodTranslations[this.report.period];return t||(t=e.periodTranslations.day),t.plural},evolutionGraphsShowForEachInPeriod(){return Object(v["translate"])("ScheduledReports_EvolutionGraphsShowForEachInPeriod","<strong>","</strong>",this.frequencyPeriodSingle)},reportSegmentInlineHelp(){return Object(v["translate"])("ScheduledReports_Segment_HelpScheduledReport",'<a href="./" rel="noreferrer noopener" target="_blank">',"</a>",Object(v["translate"])("SegmentEditor_DefaultAllVisits"),Object(v["translate"])("SegmentEditor_AddNewSegment"))},timezoneOffset(){return v["Matomo"].timezoneOffset},timeZoneDifferenceInHours(){return v["Matomo"].timezoneOffset/3600},reportHours(){const e=[];for(let t=0;t<24;t+=1)2*this.timeZoneDifferenceInHours%2!==0?e.push({key:t+".5",value:t+":30"}):e.push({key:""+t,value:""+t});return e},reportHourUtc(){const e=Q(this.report.hour,-this.timeZoneDifferenceInHours);return Object(v["translate"])("ScheduledReports_ReportHourWithUTC",[e])},saveButtonTitle(){const{ReportPlugin:e}=window,t=this.report.idreport>0;return t?e.updateReportString:e.createReportString},contentTitle(){const{ReportPlugin:e}=window,t=this.report.idreport>0;return t?e.updateReportString:Object(v["translate"])("ScheduledReports_CreateAndScheduleReport")}}});de.render=J;var pe=de;const ue={class:"first"},me={key:0},be={colspan:"7"},Oe=Object(l["createElementVNode"])("br",null,null,-1),he=Object(l["createElementVNode"])("br",null,null,-1),ye=["href"],je=Object(l["createElementVNode"])("br",null,null,-1),ge=Object(l["createElementVNode"])("br",null,null,-1),ve={key:1},Re={colspan:"7"},fe=Object(l["createElementVNode"])("br",null,null,-1),Se=Object(l["createElementVNode"])("br",null,null,-1),Ee=Object(l["createElementVNode"])("br",null,null,-1),Ne={class:"first"},ke={key:0,class:"entityInlineHelp",style:{"font-size":"9pt"}},Ve={key:0},Be={key:1},we={key:0},_e={key:0},Te=Object(l["createElementVNode"])("br",null,null,-1),Ce=["onClick"],Pe=["src"],Fe={key:2,class:"loadingPiwik"},De=["id","action"],qe=["value"],xe=Object(l["createElementVNode"])("input",{type:"hidden",name:"force_api_session",value:"1"},null,-1),Me=["onClick","id"],Le=["src"],Ie={style:{"text-align":"center","padding-top":"2px"}},$e=["onClick","title"],He=Object(l["createElementVNode"])("span",{class:"icon-edit"},null,-1),Ae=[He],Ue={style:{"text-align":"center","padding-top":"2px"}},Ge=["onClick","title"],ze=Object(l["createElementVNode"])("span",{class:"icon-delete"},null,-1),We=[ze],Ze={class:"tableActionBar"},Ke=Object(l["createElementVNode"])("span",{class:"icon-add"},null,-1);function Xe(e,t,r,o,n,i){const c=Object(l["resolveComponent"])("MatomoLoader"),a=Object(l["resolveComponent"])("ContentBlock"),s=Object(l["resolveDirective"])("content-table");return Object(l["openBlock"])(),Object(l["createBlock"])(a,{id:"entityEditContainer",class:"entityTableContainer","help-url":e.externalRawLink("https://matomo.org/docs/email-reports/"),feature:"true","content-title":e.contentTitle},{default:Object(l["withCtx"])(()=>{var r;return[Object(l["withDirectives"])((Object(l["openBlock"])(),Object(l["createElementBlock"])("table",null,[Object(l["createElementVNode"])("thead",null,[Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("th",ue,Object(l["toDisplayString"])(e.translate("General_Description")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportSchedule")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_ReportFormat")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("ScheduledReports_SendReportTo")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Download")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Edit")),1),Object(l["createElementVNode"])("th",null,Object(l["toDisplayString"])(e.translate("General_Delete")),1)])]),Object(l["createElementVNode"])("tbody",null,["anonymous"===e.userLogin?(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",me,[Object(l["createElementVNode"])("td",be,[Oe,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_MustBeLoggedIn"))+" ",1),he,Object(l["createTextVNode"])("â€º "),Object(l["createElementVNode"])("a",{href:"index.php?module="+e.loginModule},Object(l["toDisplayString"])(e.translate("Login_LogIn")),9,ye),je,ge])])):null!==(r=e.reports)&&void 0!==r&&r.length?Object(l["createCommentVNode"])("",!0):(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",ve,[Object(l["createElementVNode"])("td",Re,[fe,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_ThereIsNoReportToManage",e.siteName))+". ",1),Se,Ee])])),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.decodedReports,t=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",{key:t.idreport},[Object(l["createElementVNode"])("td",Ne,[Object(l["createTextVNode"])(Object(l["toDisplayString"])(t.description)+" ",1),e.segmentEditorActivated&&t.idsegment?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",ke,[e.savedSegmentsById[t.idsegment]?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",Ve,Object(l["toDisplayString"])(e.savedSegmentsById[t.idsegment]),1)):(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",Be,Object(l["toDisplayString"])(e.translate("ScheduledReports_SegmentDeleted")),1))])):Object(l["createCommentVNode"])("",!0)]),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.periods[t.period])+" ",1),Object(l["createElementVNode"])("td",null,[t.format?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",we,Object(l["toDisplayString"])(t.format.toUpperCase()),1)):Object(l["createCommentVNode"])("",!0)]),Object(l["createElementVNode"])("td",null,[0===t.recipients.length?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",_e,Object(l["toDisplayString"])(e.translate("ScheduledReports_NoRecipients")),1)):Object(l["createCommentVNode"])("",!0),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(t.recipients,(e,t)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",{key:t},[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e)+" ",1),Te]))),128)),0===t.recipients.length||e.sendingReports.includes(t.idreport)?Object(l["createCommentVNode"])("",!0):(Object(l["openBlock"])(),Object(l["createElementBlock"])("a",{key:1,href:"#",name:"linkSendNow",class:"link_but withIcon",style:{"margin-top":"3px"},onClick:Object(l["withModifiers"])(r=>e.$emit("sendnow",t.idreport),["prevent"])},[Object(l["createElementVNode"])("img",{border:"0",src:e.reportTypes[t.type]},null,8,Pe),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_SendReportNow")),1)],8,Ce)),e.sendingReports.includes(t.idreport)?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",Fe,[Object(l["createVNode"])(c),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_SendingReport")),1)])):Object(l["createCommentVNode"])("",!0)]),Object(l["createElementVNode"])("td",null,[Object(l["createElementVNode"])("form",{method:"POST",target:"_blank",id:"downloadReportForm_"+t.idreport,action:e.linkTo({module:"API",segment:null,method:"ScheduledReports.generateReport",idReport:t.idreport,outputType:e.downloadOutputType,language:e.language,format:-1!==["html","csv","tsv"].indexOf(t.format)?t.format:"original"})},[Object(l["createElementVNode"])("input",{type:"hidden",name:"token_auth",value:e.token_auth},null,8,qe),xe],8,De),Object(l["createElementVNode"])("a",{href:"",rel:"noreferrer noopener",name:"linkDownloadReport",class:"link_but withIcon",onClick:Object(l["withModifiers"])(r=>e.displayReport(t.idreport),["prevent"]),id:t.idreport},[Object(l["createElementVNode"])("img",{border:"0",width:16,height:16,src:e.reportFormatsByReportType[t.type][t.format]},null,8,Le),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("General_Download")),1)],8,Me)]),Object(l["createElementVNode"])("td",Ie,[Object(l["createElementVNode"])("button",{class:"table-action",onClick:r=>e.$emit("edit",t.idreport),title:e.translate("General_Edit")},Ae,8,$e)]),Object(l["createElementVNode"])("td",Ue,[Object(l["createElementVNode"])("button",{class:"table-action",onClick:r=>e.$emit("delete",t.idreport),title:e.translate("General_Delete")},We,8,Ge)])]))),128))])])),[[s]]),Object(l["createElementVNode"])("div",Ze,["anonymous"!==e.userLogin?(Object(l["openBlock"])(),Object(l["createElementBlock"])("button",{key:0,id:"add-report",onClick:t[0]||(t[0]=t=>e.$emit("create"))},[Ke,Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.translate("ScheduledReports_CreateAndScheduleReport")),1)])):Object(l["createCommentVNode"])("",!0)])]}),_:1},8,["help-url","content-title"])}var Je=Object(l["defineComponent"])({props:{contentTitle:{type:String,required:!0},userLogin:{type:String,required:!0},loginModule:{type:String,required:!0},reports:{type:Array,required:!0},siteName:{type:String,required:!0},segmentEditorActivated:Boolean,savedSegmentsById:Object,periods:{type:Object,required:!0},downloadOutputType:{type:Number,required:!0},language:{type:String,required:!0},reportFormatsByReportType:{type:Object,required:!0},reportTypes:{type:Object,required:!0},sendingReports:{type:Array,required:!1}},components:{ContentBlock:v["ContentBlock"],MatomoLoader:v["MatomoLoader"]},directives:{ContentTable:v["ContentTable"]},emits:["create","edit","delete","sendnow"],methods:{linkTo(e){return"?"+v["MatomoUrl"].stringify(Object.assign(Object.assign({},v["MatomoUrl"].urlParsed.value),e))},displayReport(e){$("#downloadReportForm_"+e).submit()}},computed:{token_auth(){return v["Matomo"].token_auth},decodedReports(){return this.reports.map(e=>Object.assign(Object.assign({},e),{},{description:v["Matomo"].helper.htmlDecode(e.description)}))}}});Je.render=Xe;var Qe=Je;function Ye(){v["Matomo"].helper.lazyScrollTo(".emailReports",200)}function et(e,t){var r;null!==(r=window.updateReportParametersFunctions)&&void 0!==r&&r[e]&&window.updateReportParametersFunctions[e](t)}function tt(e,t){var r;null!==(r=window.resetReportParametersFunctions)&&void 0!==r&&r[e]&&window.resetReportParametersFunctions[e](t)}window.resetReportParametersFunctions=window.resetReportParametersFunctions||{},window.updateReportParametersFunctions=window.updateReportParametersFunctions||{},window.getReportParametersFunctions=window.getReportParametersFunctions||{};const{$:rt}=window,ot="scheduledReports.pendingNotification",nt=v["Matomo"].timezoneOffset/3600;var lt=Object(l["defineComponent"])({props:{contentTitle:{type:String,required:!0},userLogin:{type:String,required:!0},loginModule:{type:String,required:!0},reports:{type:Array,required:!0},siteName:{type:String,required:!0},segmentEditorActivated:Boolean,savedSegmentsById:Object,periods:{type:Object,required:!0},downloadOutputType:{type:Number,required:!0},language:{type:String,required:!0},reportFormatsByReportType:{type:Object,required:!0},paramPeriods:{type:Object,required:!0},reportTypeOptions:{type:Object,required:!0},reportFormatsByReportTypeOptions:{type:Object,required:!0},displayFormats:{type:Object,required:!0},reportsByCategoryByReportType:{type:Object,required:!0},allowMultipleReportsByReportType:{type:Object,required:!0},countWebsites:{type:Number,required:!0},reportTypes:{type:Object,required:!0}},components:{MatomoLoader:v["MatomoLoader"],AddReport:pe,ListReports:Qe},directives:{ContentTable:v["ContentTable"],Form:a["Form"]},mounted(){rt(this.$refs.root).on("click","a.entityCancelLink",()=>{this.showListOfReports()}),v["Matomo"].postEvent("ScheduledReports.ManageScheduledReport.mounted",{element:this.$refs.root});const e="undefined"!==typeof sessionStorage?sessionStorage.getItem(ot):null;e&&this.$refs.reportUpdatedSuccess&&(sessionStorage.removeItem(ot),this.fadeInOutSuccessMessage(this.$refs.reportUpdatedSuccess,e,!1))},unmounted(){v["Matomo"].postEvent("ScheduledReports.ManageScheduledReport.unmounted",{element:this.$refs.root})},data(){return{showReportsList:!0,report:{},selectedReports:{},selectedReportsOrder:{},sendingReports:[]}},methods:{sendReportNow(e){this.sendingReports.includes(e)||(Ye(),this.sendingReports.push(e),v["AjaxHelper"].post({method:"ScheduledReports.sendReport"},{idReport:e,force:!0}).then(()=>{this.fadeInOutSuccessMessage(this.$refs.reportSentSuccess,Object(v["translate"])("ScheduledReports_ReportSent"),!1)}).finally(()=>{this.sendingReports=this.sendingReports.filter(t=>t!==e)}))},formSetEditReport(e){const{ReportPlugin:t}=window;let r={idreport:e,type:t.defaultReportType,format:t.defaultReportFormat,description:"",period:t.defaultPeriod,hour:t.defaultHour,reports:[],idsegment:"",evolutionPeriodFor:"prev",evolutionPeriodN:t.defaultEvolutionPeriodN,periodParam:t.defaultPeriod};e>0?(r=t.reportList[e],et(r.type,r)):tt(r.type,r),r.hour=Q(r.hour,nt),this.selectedReports={},this.selectedReportsOrder={},Object.values(r.reports).forEach(e=>{this.selectedReports[r.type]=this.selectedReports[r.type]||{},this.selectedReports[r.type][e]=!0}),this.selectedReportsOrder[r.type]=Object.values(r.reports).map(e=>e),r["format"+r.type]=r.format,r.idsegment||(r.idsegment=""),this.report=r,this.report.description=v["Matomo"].helper.htmlDecode(r.description)},fadeInOutSuccessMessage(e,t,r=!0){v["NotificationsStore"].show({message:t,placeat:e,context:"success",noclear:!0,type:"toast",style:{display:"inline-block",marginTop:"10px",width:"100%"},id:"scheduledReportSuccess"}),r&&("undefined"!==typeof sessionStorage&&sessionStorage.setItem(ot,t),v["Matomo"].helper.refreshAfter(2))},changedReportType(){tt(this.report.type,this.report)},deleteReport(e){v["Matomo"].helper.modalConfirm("#confirm",{yes:()=>{v["AjaxHelper"].post({method:"ScheduledReports.deleteReport"},{idReport:e},{redirectOnSuccess:!0})}})},showListOfReports(e){this.showReportsList=!0,v["Matomo"].helper.hideAjaxError(),("undefined"===typeof e||e)&&Ye()},createReport(){this.showReportsList=!1,Object(l["nextTick"])(()=>{this.formSetEditReport(0)})},editReport(e){this.showReportsList=!1,Object(l["nextTick"])(()=>{this.formSetEditReport(e)})},submitReport(){const e={idReport:this.report.idreport,description:this.report.description,idSegment:this.report.idsegment,reportType:this.report.type,reportFormat:this.report["format"+this.report.type],periodParam:this.report.periodParam,evolutionPeriodFor:this.report.evolutionPeriodFor};"each"!==e.evolutionPeriodFor&&(e.evolutionPeriodN=this.report.evolutionPeriodN);const{period:t}=this.report,r=Q(this.report.hour,-nt),o=e.reportType,n=this.selectedReports[o]||{};let l=(this.selectedReportsOrder[o]||[]).filter(e=>n[e]);l.length||(l=Object.keys(n).filter(e=>n[e])),l.length>0&&(e.reports=l);const i=window.getReportParametersFunctions[this.report.type](this.report);e.parameters=i;const c=this.report.idreport>0;return v["AjaxHelper"].post({method:c?"ScheduledReports.updateReport":"ScheduledReports.addReport",period:t,hour:r},e).then(()=>{Ye(),this.fadeInOutSuccessMessage(this.$refs.reportUpdatedSuccess,c?Object(v["translate"])("ScheduledReports_ReportUpdated"):Object(v["translate"])("ScheduledReports_ReportAdded"))}),!1},onChangeProperty(e,t){this.report[e]=t,"type"===e&&this.changedReportType()},toggleSelectedReport(e,t){this.selectedReports[e]=this.selectedReports[e]||{};const r=!this.selectedReports[e][t];this.selectedReports[e][t]=r,this.selectedReportsOrder[e]=this.selectedReportsOrder[e]||[],r?-1===this.selectedReportsOrder[e].indexOf(t)&&this.selectedReportsOrder[e].push(t):this.selectedReportsOrder[e]=this.selectedReportsOrder[e].filter(e=>e!==t)},onReorderSelectedReports(e,t){this.selectedReportsOrder[e]=t.filter(t=>{var r;return null===(r=this.selectedReports[e])||void 0===r?void 0:r[t]})}},computed:{showReportForm(){return!this.showReportsList},decodedSiteName(){return v["Matomo"].helper.htmlDecode(this.siteName)}}});lt.render=g;var it=lt;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=ScheduledReports.umd.min.js.map