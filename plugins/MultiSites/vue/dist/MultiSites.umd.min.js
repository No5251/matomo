(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue")):"function"===typeof define&&define.amd?define(["CoreHome"],t):"object"===typeof exports?exports["MultiSites"]=t(require("CoreHome"),require("vue")):e["MultiSites"]=t(e["CoreHome"],e["Vue"])})("undefined"!==typeof self?self:this,(function(e,t){return function(e){var t={};function o(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(a,r,function(t){return e[t]}.bind(null,r));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="plugins/MultiSites/vue/dist/",o(o.s="fae3")}({"19dc":function(t,o){t.exports=e},"8bbf":function(e,o){e.exports=t},fae3:function(e,t,o){"use strict";if(o.r(t),o.d(t,"AllWebsitesDashboard",(function(){return xe})),"undefined"!==typeof window){var a=window.document.currentScript,r=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(o.p=r[1])}var i=o("8bbf");const n={class:"dashboardHeader"},s={class:"card-title"},l={key:0},c={class:"notification system notification-error"},u=Object(i["createElementVNode"])("br",null,null,-1),d=Object(i["createElementVNode"])("br",null,null,-1),p=["href"],b=["href"],v=["href"],m={class:"dashboardControls"},h={class:"siteSearch"},O=["placeholder"],g=["title"],j=["href"];function k(e,t,o,a,r,k){const S=Object(i["resolveComponent"])("EnrichedHeadline"),f=Object(i["resolveComponent"])("KPICardContainer"),C=Object(i["resolveComponent"])("SitesTable");return Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],null,[Object(i["createElementVNode"])("div",n,[Object(i["createElementVNode"])("h1",s,[Object(i["createVNode"])(S,{"feature-name":e.translate("MultiSites_AllWebsitesDashboardTitle")},{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("MultiSites_AllWebsitesDashboardTitle")),1)]),_:1},8,["feature-name"])])]),e.errorLoading?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",l,[Object(i["createElementVNode"])("div",c,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("MultiSites_AllWebsitesDashboardErrorMessage"))+" ",1),u,d,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("General_NeedMoreHelp","",""))+" ",1),Object(i["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://matomo.org/faq/troubleshooting/faq_19489/")},Object(i["toDisplayString"])(e.translate("General_Faq")),9,p),Object(i["createTextVNode"])(" – "),Object(i["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://forum.matomo.org/")},Object(i["toDisplayString"])(e.translate("Feedback_CommunityHelp")),9,b),Object(i["createTextVNode"])(" – "),Object(i["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.externalRawLink("https://matomo.org/support-plans/")},Object(i["toDisplayString"])(e.translate("Feedback_ProfessionalHelp")),9,v),Object(i["createTextVNode"])(". ")])])):Object(i["createCommentVNode"])("",!0),Object(i["createVNode"])(f,{"is-loading":e.isLoadingKPIs,"model-value":e.kpis},null,8,["is-loading","model-value"]),Object(i["createElementVNode"])("div",m,[Object(i["createElementVNode"])("div",h,[Object(i["withDirectives"])(Object(i["createElementVNode"])("input",{type:"text",onKeydown:t[0]||(t[0]=Object(i["withKeys"])(t=>e.searchSite(e.searchTerm),["enter"])),"onUpdate:modelValue":t[1]||(t[1]=t=>e.searchTerm=t),placeholder:e.translate("Actions_SubmenuSitesearch")},null,40,O),[[i["vModelText"],e.searchTerm]]),Object(i["createElementVNode"])("span",{class:"icon-search",onClick:t[2]||(t[2]=t=>e.searchSite(e.searchTerm)),title:e.translate("General_ClickToSearch")},null,8,g)]),!e.isWidgetized&&e.isUserAllowedToAddSite?(Object(i["openBlock"])(),Object(i["createElementBlock"])("a",{key:0,class:"btn",href:e.addSiteUrl},Object(i["toDisplayString"])(e.translate("SitesManager_AddSite")),9,j)):Object(i["createCommentVNode"])("",!0)]),Object(i["createVNode"])(C,{"display-revenue":e.displayRevenue,"display-sparklines":e.displaySparklines},null,8,["display-revenue","display-sparklines"])],64)}var S=o("19dc");function f(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */const C="desc",y="nb_visits";class N{constructor(){f(this,"fetchAbort",null),f(this,"privateState",Object(i["reactive"])({dashboardKPIs:{badges:{},evolutionPeriod:"day",hits:"?",hitsCompact:"?",hitsEvolution:"",hitsTrend:0,pageviews:"?",pageviewsCompact:"?",pageviewsEvolution:"",pageviewsTrend:0,revenue:"?",revenueCompact:"?",revenueEvolution:"",revenueTrend:0,visits:"?",visitsCompact:"?",visitsEvolution:"",visitsTrend:0},dashboardSites:[],errorLoading:!1,isLoadingKPIs:!1,isLoadingSites:!1,numSites:0,paginationCurrentPage:0,sortColumn:y,sortOrder:C})),f(this,"autoRefreshInterval",0),f(this,"autoRefreshTimeout",null),f(this,"pageSize",25),f(this,"searchTerm",""),f(this,"state",Object(i["computed"])(()=>Object(i["readonly"])(this.privateState))),f(this,"numberOfPages",Object(i["computed"])(()=>Math.ceil(this.state.value.numSites/this.pageSize-1))),f(this,"currentPagingOffset",Object(i["computed"])(()=>Math.ceil(this.state.value.paginationCurrentPage*this.pageSize))),f(this,"paginationLowerBound",Object(i["computed"])(()=>0===this.state.value.numSites?0:1+this.currentPagingOffset.value)),f(this,"paginationUpperBound",Object(i["computed"])(()=>{if(0===this.state.value.numSites)return 0;const e=this.pageSize+this.currentPagingOffset.value,t=this.state.value.numSites;return e<t?e:t}))}reloadDashboard(){this.privateState.sortColumn=y,this.privateState.sortOrder=C,this.privateState.paginationCurrentPage=0,this.refreshData()}navigateNextPage(){this.privateState.paginationCurrentPage!==this.numberOfPages.value&&(this.privateState.paginationCurrentPage+=1,this.refreshData(!0))}navigatePreviousPage(){0!==this.privateState.paginationCurrentPage&&(this.privateState.paginationCurrentPage-=1,this.refreshData(!0))}searchSite(e){this.searchTerm=e,this.privateState.paginationCurrentPage=0,this.refreshData(!0)}setAutoRefreshInterval(e){this.autoRefreshInterval=e}setPageSize(e){this.pageSize=e}sortBy(e){this.privateState.sortColumn===e?this.privateState.sortOrder="desc"===this.privateState.sortOrder?"asc":"desc":this.privateState.sortOrder="label"===e?"asc":"desc",this.privateState.sortColumn=e,this.refreshData(!0)}cancelAutoRefresh(){this.autoRefreshTimeout&&(clearTimeout(this.autoRefreshTimeout),this.autoRefreshTimeout=null)}refreshData(e=!1){this.fetchAbort&&(this.fetchAbort.abort(),this.fetchAbort=null,this.cancelAutoRefresh()),this.fetchAbort=new AbortController,this.privateState.errorLoading=!1,this.privateState.isLoadingKPIs=!e,this.privateState.isLoadingSites=!0;const t={method:"MultiSites.getAllWithGroups",filter_limit:this.pageSize,filter_offset:this.currentPagingOffset.value,filter_sort_column:this.privateState.sortColumn,filter_sort_order:this.privateState.sortOrder,format_metrics:0,showColumns:["hits_evolution","hits_evolution_trend","label","hits","nb_pageviews","nb_visits","pageviews_evolution","pageviews_evolution_trend","revenue","revenue_evolution","revenue_evolution_trend","visits_evolution","visits_evolution_trend"].join(",")};return this.searchTerm&&(t.pattern=this.searchTerm),S["AjaxHelper"].fetch(t,{abortController:this.fetchAbort,createErrorNotification:!1}).then(t=>{e||(this.updateDashboardKPIs(t),S["Matomo"].postEvent("MultiSites.DashboardKPIs.updated",{parameters:(new S["AjaxHelper"]).mixinDefaultGetParams({filter_limit:this.pageSize,filter_offset:this.currentPagingOffset.value,filter_sort_column:this.privateState.sortColumn,filter_sort_order:this.privateState.sortOrder,pattern:this.searchTerm}),kpis:this.privateState.dashboardKPIs})),this.updateDashboardSites(t)}).catch(()=>{this.privateState.dashboardSites=[],this.privateState.errorLoading=!0}).finally(()=>{this.privateState.isLoadingKPIs=!1,this.privateState.isLoadingSites=!1,this.fetchAbort=null,this.startAutoRefresh()})}startAutoRefresh(){if(this.cancelAutoRefresh(),this.autoRefreshInterval<=0)return;let e;try{e=S["Periods"].parse(S["Matomo"].period,S["Matomo"].currentDateString)}catch(t){}e&&e.containsToday()&&(this.autoRefreshTimeout=setTimeout(()=>{this.autoRefreshTimeout=null,this.refreshData()},1e3*this.autoRefreshInterval))}updateDashboardKPIs(e){this.privateState.dashboardKPIs={badges:{hits:null,pageviews:null,revenue:null,visits:null},evolutionPeriod:S["Matomo"].period,hits:S["NumberFormatter"].formatNumber(e.totals.hits),hitsCompact:S["NumberFormatter"].formatNumberCompact(e.totals.hits),hitsEvolution:S["NumberFormatter"].calculateAndFormatEvolution(e.totals.hits,e.totals.previous_hits,!0),hitsTrend:Math.sign(e.totals.hits-e.totals.previous_hits),pageviews:S["NumberFormatter"].formatNumber(e.totals.nb_pageviews),pageviewsCompact:S["NumberFormatter"].formatNumberCompact(e.totals.nb_pageviews),pageviewsEvolution:S["NumberFormatter"].calculateAndFormatEvolution(e.totals.nb_pageviews,e.totals.previous_nb_pageviews,!0),pageviewsTrend:Math.sign(e.totals.nb_pageviews-e.totals.previous_nb_pageviews),revenue:S["NumberFormatter"].formatCurrency(e.totals.revenue,""),revenueCompact:S["NumberFormatter"].formatCurrencyCompact(e.totals.revenue,""),revenueEvolution:S["NumberFormatter"].calculateAndFormatEvolution(e.totals.revenue,e.totals.previous_revenue,!0),revenueTrend:Math.sign(e.totals.revenue-e.totals.previous_revenue),visits:S["NumberFormatter"].formatNumber(e.totals.nb_visits),visitsCompact:S["NumberFormatter"].formatNumberCompact(e.totals.nb_visits),visitsEvolution:S["NumberFormatter"].calculateAndFormatEvolution(e.totals.nb_visits,e.totals.previous_nb_visits,!0),visitsTrend:Math.sign(e.totals.nb_visits-e.totals.previous_nb_visits)}}updateDashboardSites(e){this.privateState.dashboardSites=e.sites,this.privateState.numSites=e.numSites}}var E=new N;const _={class:"kpiCardContainer"},T={key:0,class:"kpiCard kpiCardLoading"},V=Object(i["createElementVNode"])("div",{class:"kpiCardTitle"}," ",-1),B={class:"kpiCardValue"},P=Object(i["createElementVNode"])("div",{class:"kpiCardEvolution"},[Object(i["createElementVNode"])("span",{class:"kpiCardEvolutionTrend"}," ")],-1),M={key:0,class:"kpiCardBadge"};function D(e,t,o,a,r,n){const s=Object(i["resolveComponent"])("MatomoLoader"),l=Object(i["resolveComponent"])("KPICard");return Object(i["openBlock"])(),Object(i["createElementBlock"])("div",_,[e.isLoading?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",T,[V,Object(i["createElementVNode"])("div",B,[Object(i["createVNode"])(s)]),P,e.hasKpiBadge?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",M," ")):Object(i["createCommentVNode"])("",!0)])):(Object(i["openBlock"])(!0),Object(i["createElementBlock"])(i["Fragment"],{key:1},Object(i["renderList"])(e.kpis,(t,o)=>(Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],{key:"kpi-card-"+o},[o>0?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",{key:0,class:Object(i["normalizeClass"])({kpiCardDivider:!0,kpiCardDividerBadge:e.hasKpiBadge})}," ",2)):Object(i["createCommentVNode"])("",!0),Object(i["createVNode"])(l,{"model-value":t},null,8,["model-value"])],64))),128))])}const w={class:"kpiCard"},L={class:"kpiCardTitle"},x={style:{display:"none"},ref:"kpiCardTooltipTemplate"},F={role:"tooltip"},R=["title"],A={class:"kpiCardEvolution"},G={key:1,class:"kpiCardEvolution"},I=Object(i["createElementVNode"])("span",{class:"kpiCardEvolutionTrend"}," ",-1),z=[I],H=["title","innerHTML"];function K(e,t,o,a,r,n){const s=Object(i["resolveDirective"])("tooltips");return Object(i["openBlock"])(),Object(i["createElementBlock"])("div",w,[Object(i["createElementVNode"])("div",L,[Object(i["createElementVNode"])("span",{class:Object(i["normalizeClass"])("kpiCardIcon "+e.kpi.icon)},null,2),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate(e.kpi.title)),1)]),Object(i["createElementVNode"])("div",x,[Object(i["createElementVNode"])("div",F,[Object(i["createElementVNode"])("h3",null,Object(i["toDisplayString"])(e.translate(e.kpi.title)),1),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.kpi.value),1)])],512),Object(i["withDirectives"])((Object(i["openBlock"])(),Object(i["createElementBlock"])("div",{class:"kpiCardValue",title:e.kpi.value},[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.kpi.valueCompact),1)],8,R)),[[s,{duration:200,delay:200,content:e.tooltipContent}]]),Object(i["createElementVNode"])("div",A,[""!==e.kpi.evolutionValue?(Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],{key:0},[Object(i["createElementVNode"])("span",{class:Object(i["normalizeClass"])("kpiCardEvolutionTrend "+e.evolutionTrendClass)},[Object(i["createElementVNode"])("span",{class:Object(i["normalizeClass"])("kpiCardEvolutionIcon "+e.evolutionTrendIcon)},null,2),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.kpi.evolutionValue)+"  ",1)],2),Object(i["createElementVNode"])("span",null,Object(i["toDisplayString"])(e.translate(e.evolutionTrendFrom)),1)],64)):(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",G,z))]),e.kpi.badge?Object(i["withDirectives"])((Object(i["openBlock"])(),Object(i["createElementBlock"])("div",{key:0,class:"kpiCardBadge",title:e.kpi.badge.title,innerHTML:e.$sanitize(e.kpi.badge.label)},null,8,H)),[[s,{duration:200,delay:200}]]):Object(i["createCommentVNode"])("",!0)])}var U=Object(i["defineComponent"])({directives:{Tooltips:S["Tooltips"]},props:{modelValue:{type:Object,required:!0}},computed:{tooltipContent(){return()=>{var e;return(null===(e=this.$refs.kpiCardTooltipTemplate)||void 0===e?void 0:e.innerHTML)||""}},evolutionTrendFrom(){switch(this.kpi.evolutionPeriod){case"day":return"MultiSites_EvolutionFromPreviousDay";case"week":return"MultiSites_EvolutionFromPreviousWeek";case"month":return"MultiSites_EvolutionFromPreviousMonth";case"year":return"MultiSites_EvolutionFromPreviousYear";default:return"MultiSites_EvolutionFromPreviousPeriod"}},evolutionTrendClass(){return 1===this.kpi.evolutionTrend?"kpiTrendPositive":-1===this.kpi.evolutionTrend?"kpiTrendNegative":"kpiTrendNeutral"},evolutionTrendIcon(){return 1===this.kpi.evolutionTrend?"icon-chevron-up":-1===this.kpi.evolutionTrend?"icon-chevron-down":"icon-circle"},kpi(){return this.modelValue}}});U.render=K;var q=U,W=Object(i["defineComponent"])({components:{MatomoLoader:S["MatomoLoader"],KPICard:q},props:{isLoading:Boolean,modelValue:{type:Array,required:!0}},computed:{hasKpiBadge(){return this.kpis.some(e=>!!e.badge)},kpis(){return this.modelValue}}});W.render=D;var $=W;const J={class:"sitesTableContainer"},Y={class:"card-table dataTable sitesTable"},Q=["title"],X=["title"],Z=["title"],ee=["title"],te=["title"],oe=["title"],ae={class:"sitesTableEvolutionSelector"},re=["value"],ie={value:"hits_evolution"},ne={value:"visits_evolution"},se={value:"pageviews_evolution"},le={key:0,value:"revenue_evolution"},ce={key:0},ue={class:"sitesTableLoading",colspan:"7"},de={key:0,class:"sitesTablePagination"},pe={class:"dataTablePages"};function be(e,t,o,a,r,n){const s=Object(i["resolveComponent"])("MatomoLoader"),l=Object(i["resolveComponent"])("SitesTableSite"),c=Object(i["resolveDirective"])("tooltips");return Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],null,[Object(i["createElementVNode"])("div",J,[Object(i["withDirectives"])((Object(i["openBlock"])(),Object(i["createElementBlock"])("table",Y,[Object(i["createElementVNode"])("thead",null,[Object(i["createElementVNode"])("tr",null,[Object(i["createElementVNode"])("th",{onClick:t[0]||(t[0]=t=>e.sortBy("label")),class:"label",title:e.translate("MultiSites_MetricDocumentationWebsite")},[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("General_Website"))+" ",1),"label"===e.sortColumn?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",{key:0,class:Object(i["normalizeClass"])(e.sortColumnClass)},null,2)):Object(i["createCommentVNode"])("",!0)],8,Q),Object(i["createElementVNode"])("th",{onClick:t[1]||(t[1]=t=>e.sortBy("nb_visits")),title:e.translate("MultiSites_MetricDocumentationVisits")},["nb_visits"===e.sortColumn?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",{key:0,class:Object(i["normalizeClass"])(e.sortColumnClass)},null,2)):Object(i["createCommentVNode"])("",!0),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("General_ColumnNbVisits")),1)],8,X),Object(i["createElementVNode"])("th",{onClick:t[2]||(t[2]=t=>e.sortBy("nb_pageviews")),title:e.translate("MultiSites_MetricDocumentationPageviews")},["nb_pageviews"===e.sortColumn?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",{key:0,class:Object(i["normalizeClass"])(e.sortColumnClass)},null,2)):Object(i["createCommentVNode"])("",!0),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("General_ColumnPageviews")),1)],8,Z),Object(i["createElementVNode"])("th",{onClick:t[3]||(t[3]=t=>e.sortBy("hits")),title:e.translate("MultiSites_MetricDocumentationHits")},["hits"===e.sortColumn?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",{key:0,class:Object(i["normalizeClass"])(e.sortColumnClass)},null,2)):Object(i["createCommentVNode"])("",!0),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("General_ColumnHits")),1)],8,ee),e.displayRevenue?(Object(i["openBlock"])(),Object(i["createElementBlock"])("th",{key:0,onClick:t[4]||(t[4]=t=>e.sortBy("revenue")),title:e.translate("MultiSites_MetricDocumentationRevenue")},["revenue"===e.sortColumn?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",{key:0,class:Object(i["normalizeClass"])(e.sortColumnClass)},null,2)):Object(i["createCommentVNode"])("",!0),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("General_ColumnRevenue")),1)],8,te)):Object(i["createCommentVNode"])("",!0),Object(i["createElementVNode"])("th",{onClick:t[5]||(t[5]=t=>e.sortBy(e.evolutionSelector)),title:e.translate("MultiSites_MetricDocumentationEvolution")},[e.sortColumn===e.evolutionSelector?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",{key:0,class:Object(i["normalizeClass"])(e.sortColumnClass)},null,2)):Object(i["createCommentVNode"])("",!0),Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.translate("MultiSites_Evolution")),1)],8,oe),Object(i["createElementVNode"])("th",ae,[Object(i["createElementVNode"])("select",{class:"browser-default",value:e.evolutionSelector,onChange:t[6]||(t[6]=t=>e.changeEvolutionSelector(t.target.value))},[Object(i["createElementVNode"])("option",ie,Object(i["toDisplayString"])(e.translate("General_ColumnHits")),1),Object(i["createElementVNode"])("option",ne,Object(i["toDisplayString"])(e.translate("General_ColumnNbVisits")),1),Object(i["createElementVNode"])("option",se,Object(i["toDisplayString"])(e.translate("General_ColumnPageviews")),1),e.displayRevenue?(Object(i["openBlock"])(),Object(i["createElementBlock"])("option",le,Object(i["toDisplayString"])(e.translate("General_ColumnRevenue")),1)):Object(i["createCommentVNode"])("",!0)],40,re)])])]),Object(i["createElementVNode"])("tbody",null,[e.isLoading?(Object(i["openBlock"])(),Object(i["createElementBlock"])("tr",ce,[Object(i["createElementVNode"])("td",ue,[Object(i["createVNode"])(s)])])):(Object(i["openBlock"])(!0),Object(i["createElementBlock"])(i["Fragment"],{key:1},Object(i["renderList"])(e.sites,t=>(Object(i["openBlock"])(),Object(i["createBlock"])(l,{"display-revenue":e.displayRevenue,"evolution-metric":e.evolutionMetric,key:"site-"+t.idsite,"model-value":t,"display-sparkline":e.displaySparklines,"sparkline-metric":e.sparklineMetric},null,8,["display-revenue","evolution-metric","model-value","display-sparkline","sparkline-metric"]))),128))])])),[[c]])]),!e.isLoading||e.paginationUpperBound>0?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",de,[Object(i["withDirectives"])(Object(i["createElementVNode"])("span",{class:"dataTablePrevious",onClick:t[7]||(t[7]=t=>e.navigatePreviousPage())}," « "+Object(i["toDisplayString"])(e.translate("General_Previous")),513),[[i["vShow"],0!==e.paginationCurrentPage]]),Object(i["createElementVNode"])("span",pe,Object(i["toDisplayString"])(e.translate("General_Pagination",e.paginationLowerBound,e.paginationUpperBound,e.numberOfFilteredSites)),1),Object(i["withDirectives"])(Object(i["createElementVNode"])("span",{class:"dataTableNext",onClick:t[8]||(t[8]=t=>e.navigateNextPage())},Object(i["toDisplayString"])(e.translate("General_Next"))+" » ",513),[[i["vShow"],e.paginationCurrentPage<e.paginationMaxPage]])])):Object(i["createCommentVNode"])("",!0)],64)}const ve={class:"label"},me=["href","title"],he=Object(i["createElementVNode"])("span",{class:"icon icon-outlink"},null,-1),Oe=[he],ge=["href"],je={key:1,class:"value"},ke={class:"value"},Se={class:"value"},fe={class:"value"},Ce={key:0},ye={class:"value"},Ne=["colspan"],Ee=["src"],_e={key:1,class:"sitesTableSparkline"},Te=["href","title"],Ve=["src"];function Be(e,t,o,a,r,n){return Object(i["openBlock"])(),Object(i["createElementBlock"])("tr",{class:Object(i["normalizeClass"])({sitesTableGroup:!!e.site.isGroup,sitesTableGroupSite:!e.site.isGroup&&!!e.site.group,sitesTableSite:!e.site.isGroup&&!e.site.group})},[Object(i["createElementVNode"])("td",ve,[e.site.isGroup?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",je,Object(i["toDisplayString"])(e.siteLabel),1)):(Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],{key:0},[Object(i["createElementVNode"])("a",{rel:"noreferrer noopener",target:"_blank",href:e.site.main_url,title:e.translate("General_GoTo",e.site.main_url)},Oe,8,me),Object(i["createElementVNode"])("a",{title:"View reports",class:"value",href:e.dashboardUrl},Object(i["toDisplayString"])(e.siteLabel),9,ge)],64))]),Object(i["createElementVNode"])("td",null,[Object(i["createElementVNode"])("span",ke,Object(i["toDisplayString"])(e.formatNumber(e.site.nb_visits)),1)]),Object(i["createElementVNode"])("td",null,[Object(i["createElementVNode"])("span",Se,Object(i["toDisplayString"])(e.formatNumber(e.site.nb_pageviews)),1)]),Object(i["createElementVNode"])("td",null,[Object(i["createElementVNode"])("span",fe,Object(i["toDisplayString"])(e.formatNumber(e.site.hits)),1)]),e.displayRevenue?(Object(i["openBlock"])(),Object(i["createElementBlock"])("td",Ce,[Object(i["createElementVNode"])("span",ye,Object(i["toDisplayString"])(e.formatCurrency(e.site.revenue,e.site.currencySymbol||"")),1)])):Object(i["createCommentVNode"])("",!0),Object(i["createElementVNode"])("td",{colspan:e.displaySparkline?1:2},[!e.site.isGroup&&e.sparklineMetric in e.site?(Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],{key:0},[Object(i["createElementVNode"])("img",{src:e.evolutionIconSrc,alt:""},null,8,Ee),Object(i["createElementVNode"])("span",{class:Object(i["normalizeClass"])(e.evolutionTrendClass)},Object(i["toDisplayString"])(e.calculateAndFormatEvolution(e.site[e.sparklineMetric],e.site["previous_"+e.sparklineMetric]*e.site.ratio,!0)),3)],64)):Object(i["createCommentVNode"])("",!0)],8,Ne),e.displaySparkline?(Object(i["openBlock"])(),Object(i["createElementBlock"])("td",_e,[e.site.isGroup?Object(i["createCommentVNode"])("",!0):(Object(i["openBlock"])(),Object(i["createElementBlock"])("a",{key:0,rel:"noreferrer noopener",target:"_blank",href:e.dashboardUrl,title:e.translate("General_GoTo",e.translate("Dashboard_DashboardOf",e.siteLabel))},[Object(i["createElementVNode"])("img",{alt:"",width:"100",height:"25",src:e.evolutionSparklineSrc},null,8,Ve)],8,Te))])):Object(i["createCommentVNode"])("",!0)],2)}var Pe=Object(i["defineComponent"])({props:{displayRevenue:{type:Boolean,required:!0},evolutionMetric:{type:String,required:!0},modelValue:{type:Object,required:!0},sparklineMetric:String,displaySparkline:Boolean},computed:{dashboardUrl(){const e=S["MatomoUrl"].stringify({module:"CoreHome",action:"index",date:S["Matomo"].currentDateString,period:S["Matomo"].period,idSite:this.site.idsite});return`?${e}${this.tokenParam}`},evolutionIconSrc(){return 1===this.evolutionTrend?"plugins/MultiSites/images/arrow_up.png":-1===this.evolutionTrend?"plugins/MultiSites/images/arrow_down.png":"plugins/MultiSites/images/stop.png"},evolutionSparklineSrc(){let e=S["Matomo"].currentDateString;if("range"!==S["Matomo"].period){const{startDate:t,endDate:o}=S["Range"].getLastNRange(S["Matomo"].period,"30",S["Matomo"].currentDateString);e=`${Object(S["format"])(t)},${Object(S["format"])(o)}`}const t=S["MatomoUrl"].stringify({module:"MultiSites",action:"getEvolutionGraph",date:e,period:S["Matomo"].period,idSite:this.site.idsite,columns:this.sparklineMetric,evolutionBy:this.sparklineMetric,colors:JSON.stringify(S["Matomo"].getSparklineColors()),viewDataTable:"sparkline"});return`?${t}${this.tokenParam}`},evolutionTrend(){const e=this.evolutionMetric+"_trend";return this.site[e]},evolutionTrendClass(){return 1===this.evolutionTrend?"evolutionTrendPositive":-1===this.evolutionTrend?"evolutionTrendNegative":""},site(){return this.modelValue},siteLabel(){return S["Matomo"].helper.htmlDecode(this.site.label)},tokenParam(){const e=S["MatomoUrl"].urlParsed.value.token_auth;return e?"&token_auth="+e:""}}});Pe.render=Be;var Me=Pe,De=Object(i["defineComponent"])({directives:{Tooltips:S["Tooltips"]},components:{MatomoLoader:S["MatomoLoader"],SitesTableSite:Me},props:{displayRevenue:{type:Boolean,required:!0},displaySparklines:{type:Boolean,required:!0}},data(){return{evolutionSelector:"visits_evolution"}},computed:{errorLoading(){return E.state.value.errorLoading},errorShowProfessionalHelp(){return S["Matomo"].config&&S["Matomo"].config.are_ads_enabled},evolutionMetric(){return this.evolutionSelector},isLoading(){return E.state.value.isLoadingSites},numberOfFilteredSites(){return E.state.value.numSites},paginationCurrentPage(){return E.state.value.paginationCurrentPage},paginationLowerBound(){return E.paginationLowerBound.value},paginationUpperBound(){return E.paginationUpperBound.value},paginationMaxPage(){return E.numberOfPages.value},sites(){return E.state.value.dashboardSites},sortColumn(){return E.state.value.sortColumn},sortColumnClass(){return{sitesTableSort:!0,sitesTableSortAsc:"asc"===this.sortOrder,sitesTableSortDesc:"desc"===this.sortOrder}},sortOrder(){return E.state.value.sortOrder},sparklineMetric(){switch(this.evolutionMetric){case"hits_evolution":return"hits";case"pageviews_evolution":return"nb_pageviews";case"revenue_evolution":return"revenue";case"visits_evolution":return"nb_visits";default:return""}}},methods:{changeEvolutionSelector(e){this.evolutionSelector=e,this.sortBy(e)},navigateNextPage(){E.navigateNextPage()},navigatePreviousPage(){E.navigatePreviousPage()},sortBy(e){E.sortBy(e)}}});De.render=be;var we=De,Le=Object(i["defineComponent"])({components:{EnrichedHeadline:S["EnrichedHeadline"],KPICardContainer:$,SitesTable:we},props:{autoRefreshInterval:{type:Number,required:!0},displayRevenue:{type:Boolean,required:!0},displaySparklines:{type:Boolean,required:!0},isWidgetized:{type:Boolean,required:!0},pageSize:{type:Number,required:!0}},data(){return{searchTerm:""}},mounted(){Object(i["watch"])(()=>S["MatomoUrl"].hashParsed.value,()=>E.reloadDashboard()),E.setAutoRefreshInterval(this.autoRefreshInterval),E.setPageSize(this.pageSize),E.reloadDashboard()},computed:{addSiteUrl(){return"?"+S["MatomoUrl"].stringify(Object.assign(Object.assign(Object.assign({},S["MatomoUrl"].urlParsed.value),S["MatomoUrl"].hashParsed.value),{},{module:"SitesManager",action:"index",showaddsite:"1"}))},isLoadingKPIs(){return E.state.value.isLoadingKPIs},errorLoading(){return E.state.value.errorLoading},kpis(){var e,t,o;const{dashboardKPIs:a}=E.state.value,r=[{badge:(null===(e=a.badges)||void 0===e?void 0:e.visits)||null,icon:"icon-user",title:"MultiSites_TotalVisits",value:a.visits,valueCompact:a.visitsCompact,evolutionPeriod:a.evolutionPeriod,evolutionTrend:a.visitsTrend,evolutionValue:a.visitsEvolution},{badge:(null===(t=a.badges)||void 0===t?void 0:t.pageviews)||null,icon:"icon-show",title:"MultiSites_TotalPageviews",value:a.pageviews,valueCompact:a.pageviewsCompact,evolutionPeriod:a.evolutionPeriod,evolutionTrend:a.pageviewsTrend,evolutionValue:a.pageviewsEvolution},{badge:(null===(o=a.badges)||void 0===o?void 0:o.hits)||null,icon:"icon-hits",title:"MultiSites_TotalHits",value:a.hits,valueCompact:a.hitsCompact,evolutionPeriod:a.evolutionPeriod,evolutionTrend:a.hitsTrend,evolutionValue:a.hitsEvolution}];var i;this.displayRevenue&&r.push({badge:(null===(i=a.badges)||void 0===i?void 0:i.revenue)||null,icon:"icon-dollar-sign",title:"General_TotalRevenue",value:a.revenue,valueCompact:a.revenueCompact,evolutionPeriod:a.evolutionPeriod,evolutionTrend:a.revenueTrend,evolutionValue:a.revenueEvolution});return r},isUserAllowedToAddSite(){return S["Matomo"].hasSuperUserAccess}},methods:{searchSite(e){E.searchSite(e)}}});Le.render=k;var xe=Le;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=MultiSites.umd.min.js.map